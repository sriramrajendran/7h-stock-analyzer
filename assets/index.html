{% extends "base.html" %}

{% block content %}
{% set page_type = page_type|default('portfolio') %}

<div class="card">
    {% if page_type == 'portfolio' %}
    <h2>Portfolio Analysis</h2>
    <p class="info-text">Comprehensive analysis of your portfolio stocks with AI-powered insights</p>
    {% elif page_type == 'watchlist' %}
    <h2>Watchlist Analysis</h2>
    <p class="info-text">Track and analyze your watchlist stocks with intelligent recommendations</p>
    {% elif page_type == 'market' %}
    <h2>US Market Analysis</h2>
    <p class="info-text">Discover top investment opportunities across the US stock market</p>
    {% elif page_type == 'etf' %}
    <h2>ETF & Index Analysis</h2>
    <p class="info-text">Analyze major ETFs and market indexes for strategic investment decisions</p>
    {% elif page_type == 'import_portfolio' %}
    <h2>Import Portfolio</h2>
    <p class="info-text">Import your portfolio from Robinhood, E-Trade, or other brokerages</p>
    {% endif %}
    
    {% if page_type in ['portfolio', 'watchlist'] %}
    <form id="portfolio-form">
        <div class="form-group">
            <label for="symbols">Stock Symbols</label>
            <textarea id="symbols" name="symbols" rows="2" placeholder="Loading stocks from config file..." required></textarea>
            <small class="form-hint">Edit your configuration files in the input/ directory to update stock lists automatically</small>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="portfolio-period">Time Period</label>
                <select id="portfolio-period" name="period">
                    <option value="1mo">1 Month</option>
                    <option value="3mo">3 Months</option>
                    <option value="6mo">6 Months</option>
                    <option value="1y" selected>1 Year</option>
                    <option value="2y">2 Years</option>
                    <option value="5y">5 Years</option>
                </select>
            </div>
            <div class="form-group">
                <label for="top-n">Top N Recommendations</label>
                <input type="number" id="top-n" name="top_n" value="10" min="1" max="50">
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Analyze {{ 'Portfolio' if page_type == 'portfolio' else 'Watchlist' }}</button>
    </form>
    {% elif page_type in ['import_portfolio'] %}
    <form id="import-form" enctype="multipart/form-data">
        <div class="form-group">
            <label for="csv-file">Portfolio CSV File</label>
            <input type="file" id="csv-file" name="file" accept=".csv" required>
            <small class="form-hint">Export your portfolio as CSV from your brokerage</small>
        </div>
        <div class="form-group">
            <label for="broker-select">Brokerage</label>
            <select id="broker-select" name="broker">
                <option value="auto">Auto-detect</option>
                <option value="robinhood">Robinhood</option>
                <option value="etrade">E-Trade</option>
                <option value="fidelity">Fidelity</option>
                <option value="schwab">Charles Schwab</option>
                <option value="csv">Generic CSV</option>
            </select>
        </div>
        <div class="form-group">
            <label class="checkbox-label">
                <input type="checkbox" id="save-storage" name="save_to_storage" value="true" checked>
                Save portfolio data for persistence
            </label>
            <small class="form-hint">Keeps data available after app restarts</small>
        </div>
        <div class="form-group">
            <label class="checkbox-label">
                <input type="checkbox" id="save-config" name="save_to_config" value="true" checked>
                Save symbols to portfolio configuration
            </label>
            <small class="form-hint">Updates your portfolio for analysis</small>
        </div>
        <button type="submit" class="btn btn-primary">Import Portfolio</button>
    </form>
    {% else %}
    <form id="{% if page_type == 'market' %}market-form{% else %}etf-form{% endif %}">
        <div class="form-row">
            <div class="form-group">
                <label for="market-period">Time Period</label>
                <select id="market-period" name="period">
                    <option value="1mo">1 Month</option>
                    <option value="3mo">3 Months</option>
                    <option value="6mo" selected>6 Months</option>
                    <option value="1y">1 Year</option>
                    <option value="2y">2 Years</option>
                </select>
            </div>
            <div class="form-group">
                <label for="market-top-n">Top N Recommendations</label>
                <input type="number" id="market-top-n" name="top_n" value="10" min="1" max="20">
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Analyze {{ 'US Market' if page_type == 'market' else 'ETFs/Indexes' }}</button>
    </form>
    {% endif %}
    <div id="portfolio-results"></div>
</div>

<!-- Loading Overlay -->
<div id="loading" class="loading-overlay hidden">
    <div class="spinner"></div>
    <p>Analyzing market data...</p>
</div>
{% endblock %}

{% block scripts %}
<script>
// Set page type from template - available globally
window.PAGE_TYPE = '{{ page_type|default("portfolio") }}';
</script>
{% endblock %}

